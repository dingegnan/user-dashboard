<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase æ•°æ®ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="app.js" defer></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; line-height: 1.6; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 25px; margin: 20px 0; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .btn { background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; transition: all 0.3s; }
        .btn:hover { background: #2563eb; transform: translateY(-1px); }
        .btn:disabled { background: #9ca3af; cursor: not-allowed; transform: none; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: #f59e0b; }
        .btn-warning:hover { background: #d97706; }
        input, select, textarea { padding: 10px; margin: 5px 0; border: 1px solid #d1d5db; border-radius: 6px; width: 100%; font-size: 14px; transition: border 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .hidden { display: none; }
        .tab { display: flex; border-bottom: 2px solid #e5e7eb; margin-bottom: 24px; background: #f8fafc; border-radius: 8px; padding: 4px; flex-wrap: wrap; }
        .tab-btn { flex: 1; min-width: 120px; padding: 12px; background: none; border: none; cursor: pointer; border-radius: 6px; transition: all 0.3s; margin: 2px; }
        .tab-btn.active { background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1); color: #3b82f6; font-weight: 600; }
        .status { padding: 12px; border-radius: 8px; margin: 16px 0; font-size: 14px; }
        .status.success { background: #ecfdf5; border: 1px solid #a7f3d0; color: #065f46; }
        .status.error { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; }
        .status.info { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }
        .status.warning { background: #fffbeb; border: 1px solid #fde68a; color: #92400e; }
        .table-container { overflow-x: auto; margin: 16px 0; border-radius: 8px; border: 1px solid #e5e7eb; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        th { background: #f8fafc; font-weight: 600; color: #374151; position: sticky; top: 0; }
        tr:hover { background: #f9fafb; }
        tr.editing { background: #f0f9ff; }
        .action-buttons { display: flex; gap: 8px; margin: 10px 0; flex-wrap: wrap; }
        .config-panel { background: #f0f9ff; border: 1px solid #bae6fd; }
        .table-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin: 15px 0; }
        .table-item { padding: 15px; background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .table-item:hover { background: #eff6ff; border-color: #3b82f6; }
        .table-item.active { background: #dbeafe; border-color: #3b82f6; color: #1e40af; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; min-width: 400px; max-width: 90%; max-height: 80%; overflow-y: auto; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #374151; }
        .edit-cell { background: #f0f9ff; border: 1px solid #3b82f6; border-radius: 4px; padding: 8px; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; margin: 20px 0; }
        .page-btn { padding: 8px 16px; border: 1px solid #d1d5db; background: white; cursor: pointer; border-radius: 4px; }
        .page-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        .page-btn:disabled { background: #f3f4f6; color: #9ca3af; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="color: #3b82f6; font-size: 2.5em; margin-bottom: 8px;">ğŸš€ Supabase æ•°æ®ç®¡ç†ç³»ç»Ÿ</h1>
            <p style="color: #6b7280; font-size: 1.1em;">å®Œæ•´çš„æ•°æ®åº“è¡¨ç®¡ç†å’Œæ•°æ®æ“ä½œè§£å†³æ–¹æ¡ˆ</p>
        </div>

        <!-- é…ç½®é¢æ¿ -->
        <div class="card config-panel" id="config-section">
            <h2>ğŸ”§ æ•°æ®åº“è¿æ¥é…ç½®</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">è‡ªåŠ¨é…ç½® Supabase è¿æ¥</p>
            
            <div style="display: grid; gap: 16px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Project URL:</label>
                    <input type="text" id="supabase-url" 
                           value="https://umcobpyncbalzwquaers.supabase.co" readonly
                           style="background: #f8f9fa;">
                </div>
                
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Anon Key:</label>
                    <input type="text" id="supabase-key" 
                           value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtY29icHluY2JhbHp3cXVhZXJzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3NzMzMzMsImV4cCI6MjA3ODM0OTMzM30.VCZRjCDgVwNXu3e6Etmx6ppLBkIif_kbIE7IFRhU8OU" 
                           readonly
                           style="background: #f8f9fa;">
                </div>
            </div>
            
            <button class="btn btn-success" onclick="initializeApp()" style="margin-top: 16px;">
                ğŸ”— è¿æ¥æ•°æ®åº“
            </button>
            <div id="config-status" class="status hidden"></div>
        </div>

        <!-- ä¸»ä»ªè¡¨æ¿ -->
        <div class="card hidden" id="dashboard-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 10px;">
                <h2 style="margin: 0;">ğŸ“Š æ•°æ®ç®¡ç†é¢æ¿</h2>
                <div style="color: #6b7280; font-size: 14px;">
                    ğŸ”“ å…è®¤è¯ç›´æ¥è®¿é—® | å½“å‰è¡¨: <span id="current-table-name">æœªé€‰æ‹©</span>
                </div>
            </div>

            <!-- æ ‡ç­¾é¡µ -->
            <div class="tab">
                <button class="tab-btn active" onclick="switchTab('tables')">ğŸ“‹ è¡¨ç®¡ç†</button>
                <button class="tab-btn" onclick="switchTab('data')">ğŸ“Š æ•°æ®ç¼–è¾‘</button>
                <button class="tab-btn" onclick="switchTab('import')">ğŸ“¥ æ•°æ®å¯¼å…¥</button>
                <button class="tab-btn" onclick="switchTab('export')">ğŸ“¤ æ•°æ®å¯¼å‡º</button>
                <button class="tab-btn" onclick="switchTab('sql')">ğŸ”§ SQL å·¥å…·</button>
            </div>

            <!-- è¡¨ç®¡ç† -->
            <div id="tab-tables">
                <h3>ğŸ—ƒï¸ æ•°æ®åº“è¡¨åˆ—è¡¨</h3>
                <p style="color: #6b7280; margin-bottom: 20px;">ç‚¹å‡»è¡¨åé€‰æ‹©è¦æ“ä½œçš„æ•°æ®è¡¨</p>
                
                <div class="action-buttons">
                    <button class="btn" onclick="refreshTableList()">ğŸ”„ åˆ·æ–°è¡¨åˆ—è¡¨</button>
                    <button class="btn btn-success" onclick="showCreateTableModal()">â• åˆ›å»ºæ–°è¡¨</button>
                </div>
                
                <div id="tables-container" class="table-list">
                    <!-- è¡¨åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div id="table-stats" class="status info hidden">
                    <!-- è¡¨ç»Ÿè®¡ä¿¡æ¯ -->
                </div>
            </div>

            <!-- æ•°æ®ç¼–è¾‘ -->
            <div id="tab-data" class="hidden">
                <h3>ğŸ“ æ•°æ®ç¼–è¾‘</h3>
                <p style="color: #6b7280; margin-bottom: 20px;">ç¼–è¾‘é€‰ä¸­çš„æ•°æ®è¡¨å†…å®¹</p>
                
                <div class="action-buttons">
                    <button class="btn" onclick="loadTableData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
                    <button class="btn btn-success" onclick="addNewRow()">â• æ·»åŠ æ–°è¡Œ</button>
                    <button class="btn btn-warning" onclick="enableEditing()">âœï¸ å¯ç”¨ç¼–è¾‘</button>
                    <button class="btn btn-danger" onclick="deleteSelectedRows()">ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­</button>
                    <button class="btn" onclick="saveAllChanges()">ğŸ’¾ ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
                </div>
                
                <div id="data-controls" style="margin: 15px 0;">
                    <label>æ¯é¡µæ˜¾ç¤ºè¡Œæ•°: </label>
                    <select id="page-size" onchange="loadTableData()">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    
                    <label style="margin-left: 20px;">æœç´¢: </label>
                    <input type="text" id="search-input" placeholder="è¾“å…¥æœç´¢å…³é”®è¯..." style="width: 200px;" onkeyup="loadTableData()">
                </div>
                
                <div id="data-container" class="table-container">
                    <!-- æ•°æ®è¡¨æ ¼å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div class="pagination" id="pagination-controls">
                    <!-- åˆ†é¡µæ§ä»¶å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ•°æ®å¯¼å…¥ -->
            <div id="tab-import" class="hidden">
                <h3>ğŸ“¥ æ•°æ®å¯¼å…¥</h3>
                <p style="color: #6b7280; margin-bottom: 20px;">å¯¼å…¥æ•°æ®å°†æ¸…ç©ºç›®æ ‡è¡¨çš„ç°æœ‰æ•°æ®</p>
                
                <div style="display: grid; gap: 16px;">
                    <div class="form-group">
                        <label>ç›®æ ‡è¡¨:</label>
                        <select id="import-table-name">
                            <option value="">è¯·å…ˆé€‰æ‹©è¡¨</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰æ‹©æ–‡ä»¶ (JSON/CSV):</label>
                        <input type="file" id="file-input" accept=".json,.csv">
                    </div>
                    
                    <div class="form-group">
                        <label>å¯¼å…¥é€‰é¡¹:</label>
                        <div>
                            <input type="checkbox" id="clear-table" checked>
                            <label for="clear-table">æ¸…ç©ºç›®æ ‡è¡¨ç°æœ‰æ•°æ®</label>
                        </div>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="handleImport()" style="margin-top: 16px;">
                    ğŸ“¤ å¼€å§‹å¯¼å…¥
                </button>
                
                <div id="import-preview" style="margin-top: 20px;"></div>
                <div id="import-result"></div>
            </div>

            <!-- æ•°æ®å¯¼å‡º -->
            <div id="tab-export" class="hidden">
                <h3>ğŸ“¤ æ•°æ®å¯¼å‡º</h3>
                <p style="color: #6b7280; margin-bottom: 20px;">å°†æ•°æ®å¯¼å‡ºä¸ºæ–‡ä»¶æ ¼å¼</p>
                
                <div style="display: grid; gap: 16px;">
                    <div class="form-group">
                        <label>é€‰æ‹©è¡¨:</label>
                        <select id="export-table-name">
                            <option value="">è¯·å…ˆé€‰æ‹©è¡¨</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>å¯¼å‡ºæ ¼å¼:</label>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn" onclick="exportAsJSON()">ğŸ“„ JSON</button>
                            <button class="btn" onclick="exportAsCSV()">ğŸ“Š CSV</button>
                            <button class="btn" onclick="exportAsExcel()">ğŸ“ˆ Excel</button>
                        </div>
                    </div>
                </div>
                
                <div id="export-result" style="margin-top: 20px;"></div>
            </div>

            <!-- SQL å·¥å…· -->
            <div id="tab-sql" class="hidden">
                <h3>ğŸ”§ SQL æŸ¥è¯¢å·¥å…·</h3>
                <p style="color: #6b7280; margin-bottom: 20px;">æ‰§è¡Œè‡ªå®šä¹‰ SQL æŸ¥è¯¢</p>
                
                <div class="form-group">
                    <label>SQL æŸ¥è¯¢:</label>
                    <textarea id="sql-query" rows="6" placeholder="è¾“å…¥ SQL æŸ¥è¯¢è¯­å¥ï¼Œä¾‹å¦‚: SELECT * FROM è¡¨å LIMIT 10"></textarea>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="executeSQL()">ğŸš€ æ‰§è¡ŒæŸ¥è¯¢</button>
                    <button class="btn" onclick="clearSQL()">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
                
                <div id="sql-result" style="margin-top: 20px;"></div>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºè¡¨æ¨¡æ€æ¡† -->
    <div id="create-table-modal" class="modal">
        <div class="modal-content">
            <h3>åˆ›å»ºæ–°è¡¨</h3>
            <div class="form-group">
                <label>è¡¨å:</label>
                <input type="text" id="new-table-name" placeholder="è¾“å…¥è¡¨å">
            </div>
            <div class="form-group">
                <label>è¡¨ç»“æ„ (JSON):</label>
                <textarea id="table-schema" rows="8" placeholder='ä¾‹å¦‚: [
  {"name": "id", "type": "serial", "primary": true},
  {"name": "name", "type": "varchar(255)"},
  {"name": "created_at", "type": "timestamptz", "default": "now()"}
]'></textarea>
            </div>
            <div class="action-buttons">
                <button class="btn btn-success" onclick="createTable()">åˆ›å»ºè¡¨</button>
                <button class="btn" onclick="hideModal('create-table-modal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘è¡Œæ¨¡æ€æ¡† -->
    <div id="edit-row-modal" class="modal">
        <div class="modal-content">
            <h3>ç¼–è¾‘æ•°æ®è¡Œ</h3>
            <div id="edit-form-container">
                <!-- ç¼–è¾‘è¡¨å•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="action-buttons">
                <button class="btn btn-success" onclick="saveRowEdit()">ä¿å­˜</button>
                <button class="btn" onclick="hideModal('edit-row-modal')">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
</body>
</html>
